module.exports=function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="/dist/",t(t.s=11)}([function(e,r){e.exports=require("mongoose")},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("body-parser")},function(e,r){e.exports=require("cookie-parser")},function(e,r){e.exports=require("compression")},function(e,r){e.exports=require("cors")},function(e,r){e.exports=require("helmet")},function(e,r){e.exports=require("crypto")},function(e,r){e.exports=require("lodash")},function(e,r){e.exports=require("jsonwebtoken")},function(e,r){e.exports=require("express-jwt")},function(e,r,t){e.exports=t(12)},function(e,r,t){"use strict";t.r(r);var n={env:"production",port:process.env.PORT||3e3,jwtSecret:process.env.JWT_SECRET||"Gam#cub331",mongoUri:process.env.MONGODB_URI||process.env.MONGO_HOST||"mongodb://"+(process.env.IP||"localhost")+":"+(process.env.MONGO_PORT||"27017")+"/mernproject"},o=t(1),s=t.n(o),i=t(2),a=t.n(i),u=t(3),d=t.n(u),c=t(4),l=t.n(c),f=t(5),p=t.n(f),h=t(6),m=t.n(h),g=t(0),v=t.n(g),w=t(7),y=t.n(w),x=new v.a.Schema({name:{type:String,trim:!0,required:"Name is required"},email:{type:String,trim:!0,unique:"Email already exists",match:[/.+\@.+\..+/,"Please fill a valid email address"],required:"Email is required"},created:{type:Date,default:Date.now},upated:Date,hashed_password:{type:String,required:"Password is requid"},salt:String});x.virtual("password").set(function(e){this._password=e,this.salt=this.makeSalt(),this.hashed_password=this.encryptPassword(e)}).get(function(){return this._password}),x.methods={authenticate:function(e){return this.encryptPassword(e)===this.hashed_password},encryptPassword:function(e){if(!e)return"";try{return y.a.createHmac("sha1",this.salt).update(e).digest("hex")}catch(e){return""}},makeSalt:function(){return Math.round(new Date*Math.random())+""}},x.path("hashed_password").validate(function(e){this._password&&this._password.length<6&&this.invalidate("password","Password must be at least 6 characters."),this.isNew&&!this._password&&this.invalidate("password","Password is required")},null);var j=v.a.model("User",x),b=t(8),_=t.n(b),S=function(e){var r;try{var t=e.message.substring(e.message.lastIndexOf(".$")+2,e.message.lastIndexOf(_1));r=t.charAt(0).toUpperCase()+t.slice(1)+" already exists"}catch(e){r="Unique field already exists"}return r},q=function(e){var r="";if(e.code)switch(e.code){case 11e3:case 11001:r=S(e);break;default:r="Something went wrong"}else for(var t in e.errors)e.errors[t].message&&(r=e.errors[t].message);return r},O=function(e,r,t){new j(e.body).save(function(e,t){if(e)return r.status(400).json({error:q(e)});r.status(200).json({message:"Successfully signed up!"})})},P=function(e,r,t,n){j.findById(n).exec(function(n,o){if(n||!o)return r.status("400").json({error:"User not found"});e.profile=o,t()})},U=function(e,r){return e.profile.hashed_password=void 0,e.profile.salt=void 0,r.json(e.profile)},M=function(e,r){j.find(function(e,t){if(e)return r.status(400).json({error:q(e)});r.json(t)}).select("name email updated created")},E=function(e,r,t){e.profile.remove(function(e,t){if(e)return r.status(400).json({error:q(e)});t.hashed_password=void 0,t.salt=void 0,r.json(t)})},k=function(e,r,t){var n=e.profile;(n=_.a.extend(n,e.body)).updated=Date.now(),n.save(function(e){if(e)return r.status(400).json({error:q(e)});n.hashed_password=void 0,n.salt=void 0,r.json(n)})},D=t(9),I=t.n(D),T=t(10),N={signin:function(e,r){j.findOne({email:e.body.email},function(t,o){if(t||!o)return r.status("401").json({error:"User not found"});if(!o.authenticate(e.body.password))return r.status("401"),json({error:"Email and password don't match."});var s=I.a.sign({_id:o._id},n.jwtSecret);return r.cookie("t",s,{expire:new Date+9999}),r.json({token:s,user:{_id:o._id,name:o.name,email:o.email}})})},signout:function(e,r){return r.clearCookie("t"),r.status("200").json({message:"signed out"})},requireSigin:t.n(T)()({secret:n.jwtSecret,userProperty:"auth"}),hasAuthorization:function(e,r,t){if(!e.profile||!e.auth||e.profile._id!=e.auth._id)return r.status("403").json({error:"User is not authorized"});t()}},R=s.a.Router();R.route("/api/users").get(M).post(O),R.route("/api/users/:userId").get(N.requireSigin,U).put(N.requireSigin,N.hasAuthorization,k).delete(N.requireSigin,N.hasAuthorization,E),R.param("userId",P);var z=R,C=s.a.Router();C.route("/auth/signin").post(N.signin),C.route("/auth/signout").get(N.signout);var A=C,G=s()();G.use(a.a.json()),G.use(a.a.urlencoded({extended:!0})),G.use(d()()),G.use(l()()),G.use(m()()),G.use(p()()),G.use("/",z),G.use("/",A),G.get("/",function(e,r){r.status(200).send('<!DOCTYPE html>\n  <html>\n    <head><meta charset="utf-8">\n    <title>MERN SKeleton</title>\n    </head>\n    <body>\n    <div id="root">Hello World</div>\n    </body>\n  </html>\n  \n  ')}),G.use(function(e,r,t,n){"UnauthorizedError"===e.name&&t.status(401).json({error:e.name+": "+e.message})});var H=G;v.a.Promise=global.Promise,v.a.connect(n.mongoUri,{useCreateIndex:!0,useNewUrlParser:!0}),v.a.connection.on("error",function(){throw new Error("unable to connect to database: ".concat(mongoUri))}),H.listen(n.port,function(e){e&&console.log(e),console.info("Server started on port %s.",n.port)})}]);